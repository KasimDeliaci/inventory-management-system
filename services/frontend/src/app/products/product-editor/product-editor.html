<!-- Backdrop -->
<div class="backdrop" (click)="close.emit()"></div>
<!-- Modal -->
<section class="modal" role="dialog" aria-modal="true" (click)="$event.stopPropagation()">
  <button class="close" aria-label="Close" (click)="close.emit()">✕</button>
  <div class="grid">
    <!-- Left/top fields -->
    <div class="row1">
      <label class="box">
        <span class="label">ID</span>
        <input type="text" class="input" [value]="form.value.id"
               readonly
               (input)="form.controls.id.setValue(($any($event.target).value || ''))">
        <small *ngIf="isNewProduct" class="help-text">ID will be generated automatically</small>
      </label>
      <label class="box" [class.error]="isFieldInvalid('name')">
        <span class="label">NAME *</span>
        <input type="text" 
               class="input" 
               [value]="form.value.name"
               [class.error]="isFieldInvalid('name')"
               (input)="form.controls.name.setValue(($any($event.target).value || ''))">
        <small *ngIf="isFieldInvalid('name')" class="error-text">{{ getFieldError('name') }}</small>
      </label>
    </div>
    
    <label class="box big">
      <span class="label">DESCRIPTION</span>
      <textarea class="textarea" 
                [value]="form.value.description || ''"
                placeholder="Enter product description..."
                (input)="form.controls.description.setValue($any($event.target).value)"></textarea>
    </label>
    
    <!-- Right column small boxes -->
    <div class="sidebar">
      <label class="box">
        <span class="label">PRICE</span>
        <input type="number" 
               class="input" 
               [value]="form.value.price ?? ''"
               placeholder="0.00"
               step="0.01"
               min="0"
               (input)="form.controls.price.setValue($any($event.target).valueAsNumber || null)">
      </label>
      <label class="box" [class.error]="isFieldInvalid('category')">
        <span class="label">CATEGORY *</span>
        <input type="text" 
               class="input" 
               [value]="form.value.category || ''"
               [class.error]="isFieldInvalid('category')"
               placeholder="e.g. Beverages"
               (input)="form.controls.category.setValue($any($event.target).value)">
        <small *ngIf="isFieldInvalid('category')" class="error-text">{{ getFieldError('category') }}</small>
      </label>
      <label class="box" [class.error]="isFieldInvalid('unit')">
        <span class="label">UNIT *</span>
        <input type="text" 
               class="input" 
               [value]="form.value.unit || ''"
               [class.error]="isFieldInvalid('unit')"
               placeholder="e.g. adet, kg, lt, şişe"
               (input)="form.controls.unit.setValue($any($event.target).value)">
        <small *ngIf="isFieldInvalid('unit')" class="error-text">{{ getFieldError('unit') }}</small>
      </label>
      <label class="box">
        <span class="label">SAFETY STOCK</span>
        <input type="number" 
               class="input" 
               [value]="form.value.safetyStock ?? ''"
               placeholder="0"
               min="0"
               step="1"
               (input)="form.controls.safetyStock.setValue($any($event.target).valueAsNumber || null)">
      </label>
      <label class="box">
        <span class="label">REORDER POINT</span>
        <input type="number" 
               class="input" 
               [value]="form.value.reorderPoint ?? ''"
               placeholder="0"
               min="0"
               step="1"
               (input)="form.controls.reorderPoint.setValue($any($event.target).valueAsNumber || null)">
      </label>
      <label class="box">
        <span class="label">CURRENT STOCK</span>
        <input type="number" 
               class="input" 
               [value]="form.value.currentStock ?? ''"
               readonly
               placeholder="0"
               (input)="form.controls.currentStock.setValue($any($event.target).valueAsNumber || null)">
        <small class="help-text">Read-only field</small>
      </label>
    </div>
    
    <!-- Supplier table -->
    <div class="supplier">
      <div class="supplier-head">SUPPLIERS</div>
      <div class="table" *ngIf="suppliers.length > 0; else noSuppliers">
        <div class="thead">
          <div>SELECT</div>
          <div>PREFERRED</div>
          <div>NAME</div>
          <div>E-MAIL</div>
          <div>PHONE</div>
          <div>CITY</div>
        </div>
        <div class="table-body">
          <div class="row2" *ngFor="let s of sortedSuppliers">
            <div>
              <input type="checkbox"
                     [checked]="isActiveSupplier(s.id)"
                     (change)="toggleActiveSupplier(s.id, $event)">
            </div>
            <div>
              <input type="radio"
                     name="preferred"
                     [value]="s.id"
                     [checked]="s.id === form.value.preferredSupplierId"
                     [disabled]="!isActiveSupplier(s.id)"
                     (change)="setPreferredSupplier(s.id)">
            </div>
            <div>{{ s.name }}</div>
            <div>{{ s.email }}</div>
            <div>{{ s.phone }}</div>
            <div>{{ s.city }}</div>
          </div>
        </div>
      </div>
      <ng-template #noSuppliers>
        <div class="no-suppliers">
          <p>No suppliers available</p>
        </div>
      </ng-template>
    </div>
    
    <!-- Actions -->
    <div class="actions">
      <button class="btn primary" 
              type="button" 
              (click)="onSave()"
              [disabled]="isSaving">
        {{ isSaving ? (isNewProduct ? 'CREATING...' : 'UPDATING...') : 'SAVE' }}
      </button>
      <button class="btn danger" 
              type="button" 
              (click)="onDelete()" 
              [disabled]="!canDelete || isDeleting || isSaving"
              *ngIf="!isNewProduct">
        {{ isDeleting ? 'DELETING...' : 'DELETE' }}
      </button>
    </div>
    
    <!-- Form validation summary (optional) -->
    <div class="validation-summary" *ngIf="form.invalid && form.touched">
      <p class="error-text">Please fill in all required fields marked with *</p>
    </div>
  </div>
</section>